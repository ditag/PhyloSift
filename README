AMPHORA2

AMPHORA is an Automated Phylogenomic Inference Pipeline for bacterial sequences. From a given a set of protein sequences, it automatically identifies various phylogenetic marker genes. It then generates high-quality multiple sequence alignments for these genes and make tree-based phylotype assignments.



NEW VERSION
=============================================================
AMPHORA 2 has several new features over AMPHORA
-The number of markers is being expanded from the original 31 Bacteria only markers to many more from Archaea and Bacteria (and possibly Eukaryotes and viruses)
-HMMER 3 replaces the older, slower, HMMER 2
-Use of Pplacer from Erick Matsen to place the reads on the reference trees
-Use of BioPerl 1.6.1
-Use of Rapsearch for short read input.
-...more to come

Install
==========================================

==== The easy way ====

Download the tarball archive from http://edhar.genomecenter.ucdavis.edu/~koadman/amphora2/amphora2_latest.tar.bz2

Navigate to the directory where you want to install A2.

   >tar -xvf amphora2_latest.tar.bz2

Amphora-2 is ready for use, refer to the Usage section.

==== Update the fast way ====

Download and install Git from http://github.com/   OR  run the following unix command : >apt-get install git

To update Amphora-2, navigate to the Amphora-2 directory and run the following command.
   >cd Amphora-2
   >git pull

Amphora-2 is ready for use

==== Update ====

Follow the install steps of downloading the tarball
This method will redownload all the binaries and library in addition to new code.  This may not be as fast as the github update method.


Index preparationg step
==========================================

$ perl amphora2 index <sequence_file>

Usage
==========================================
$ perl amphora2 <Mode> <options> <sequence_file>

   sequence_file needs to be in fasta format

$ perl amphora2 <Mode> <options> -paired <sequence_file_1> <sequence_file_2>

   sequence_file_1 and _2 need to be in fastq format

Mode : Only execute a specific step in the pipeline
  all - execute all the following steps in that order.
  search - only execute the database searches + write candidate files
  align - hmmsearch + hmmalign + trims + coverage filters
  placer - run pplacer on the results from the align step
  summary - run the taxonomy assignment steps

Options Available at this time : 
   -h -help             Prints the usage section of the README
   -custom <file>       Reads a custom marker list from a file otherwise use all the markers from the markers directory
   --threaded=<Number>  Runs Blast and Hmmer using the number of processors sepcified
                        Runs 1 Pplacer per processor specified
		        (DEFAULT : 1)
   -clean               Cleans the temporary files created by Amphora (NOT YET IMPLEMENTED)
   -paired              Looks for 2 input files (paired end sequencing) in FastQ format.  
   			Reversing the sequences for the second file listed 
			and appending to the corresponding pair from the first file listed.
   -continue            Enables the pipeline to continue to subsequent steps when not using the 'all' mode
   -reverse		If the submitted sequences were Nucleotides, the program prints out an alignment for all the markers in DNA space in addition to the one in Protein space.
   -isolate             Use this mode if you are running data from an Isolate genome
   -updated_markers     Use the set of updated markers with newly sequenced genomes instead of the stock markers

Requirements
==========================================

A 64bit operating system is required as the binaries packaged with the Amphora-2 scripts were compiled using such OS.
Amphora-2 will NOT work on a 32bit operating system.

Default Markers used by Amphora-2
=========================================
PMPROK00003  PMPROK00025  PMPROK00048  PMPROK00064  PMPROK00081  PMPROK00106
PMPROK00014  PMPROK00028  PMPROK00050  PMPROK00067  PMPROK00086  PMPROK00123
PMPROK00015  PMPROK00029  PMPROK00051  PMPROK00068  PMPROK00087  PMPROK00126
PMPROK00019  PMPROK00031  PMPROK00052  PMPROK00069  PMPROK00092
PMPROK00020  PMPROK00034  PMPROK00053  PMPROK00071  PMPROK00093
PMPROK00022  PMPROK00041  PMPROK00054  PMPROK00074  PMPROK00094
PMPROK00024  PMPROK00047  PMPROK00060  PMPROK00075  PMPROK00097

This data has not yet been pusblished.

Results
==========================================

All results are generated within the Amphora-2 directory in the the Amph_temp/<filename>/ directory.
    blastDir : All files related to the Blast / Rapsearch step.
               *.candidate           Fasta format of the candidate sequences in Protein space for each marker
               *.candidate.ffn       Fasta format of the candidate sequences in DNA space for each marker (option activated)
               blastrep.faa          Fasta format of the Reference sequences used in the Blast search
               blastrep.faa.*        Blast database used by Blast
               isolated.tabblastx    File used by the isolate mode when running isolate genomes through A2

    alignDir : All files related to the alignment and masking steps.
    	       *.aln_hmmer3.fasta    hmmer3 generated alignment for the candidate sequences in fasta format
	       *.aln_hmmer3.trim     Trimmed version of the previous file
	       *.hmmsearch.out 	     Hmmersearch output of the candidate sequences Vs the markers HMM profile               
	       *.hmmsearch.tblout    Tabular version of the hmmsearch.out file
	       *.newCandidate	     Fasta file of the candidate sequences after the hmmsearch filter
	       *.seed.stock 	     stockholm format of the reference sequences alignment
	       *.stock.hmm	     HMM profile

    treeDir : All files related to the tree placements of the candidate sequences by Pplacer.
    	      *.place 		     Placement file for the newCandidate sequences

    taxasummary.txt 		     Probability mass over taxa present in the sample, tab-delimited text
		Column 1 -- NCBI Taxon ID
		Column 2 -- Taxonomic rank (genus, species, phylum, etc)
		Column 3 -- Name
		Column 4 -- Read/sequence probability sum placed at this taxon
			    The values in this column can be normalized to sum to 1, the result will be a rank-abundance distribution

    taxaconfidence.txt		     Quantiles over the probability distribution for number of reads at a taxonomic level
                                     under a multinomial model of read sampling from taxa during the sequencing process.
		Column 1 -- NCBI Taxon ID
		Column 2 -- Taxonomic rank (genus, species, phylum, etc)
		Column 3 -- Name
		Column 4 -- Minimum number of reads
		Column 5 -- Number of reads at 10th percentile
		Column 6 -- Number of reads at 25th percentile
		Column 7 -- Median number of reads
		Column 8 -- Number of reads at 75th percentile
		Column 9 -- Number of reads at 90th percentile
		Column 10 -- Maximum number of reads




SUPPORT AND DOCUMENTATION
==========================================

After installing, you can find documentation for this module with the
perldoc command.

    perldoc Amphora2::Amphora2

You can also look for information at:

    RT, CPAN's request tracker (report bugs here)
        http://rt.cpan.org/NoAuth/Bugs.html?Dist=Amphora2-Amphora2

    AnnoCPAN, Annotated CPAN documentation
        http://annocpan.org/dist/Amphora2-Amphora2

    CPAN Ratings
        http://cpanratings.perl.org/d/Amphora2-Amphora2

    Search CPAN
        http://search.cpan.org/dist/Amphora2-Amphora2/


LICENSE AND COPYRIGHT
===========================================

Copyright (C) 2011 Aaron Darling

This program is free software; you can redistribute it and/or modify it
under the terms of either: the GNU General Public License as published
by the Free Software Foundation; or the Artistic License.

See http://dev.perl.org/licenses/ for more information.

Contact information
===========================================
